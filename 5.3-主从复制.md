### 全量复制
- 原理
  - 第一步：同步RDB文件
    - 1.从服务器连接主服务器，发送SYNC命令； 
    - 2.主服务器接收到SYNC命名后，开始执行BGSAVE命令生成RDB文件并使用缓冲区记录此后执行的所有写命令
    - 3.主服务器BGSAVE执行完后，向所有从服务器发送快照文件，并在发送期间继续记录被执行的写命令
    - 4.从服务器收到快照文件后丢弃所有旧数据，载入收到的快照； 
  - 第二步：复制缓冲区
    - 主服务器快照发送完毕后开始向从服务器发送缓冲区中的写命令；
    - 从服务器完成对快照的载入，开始接收命令请求，并执行来自主服务器缓冲区的写命令；
- 注意点

如果多个Slave断线了，需要重启的时候，因为只要Slave启动，就会发送sync请求和主机全量同步，当多个同时出现的时候，可能会导致Master IO剧增宕机。

### 增量复制

Redis增量复制是指Slave初始化后开始正常工作时主服务器发生的写操作同步到从服务器的过程。 

增量复制的过程主要是主服务器每执行一个写命令就会向从服务器发送相同的写命令，从服务器接收并执行收到的写命令。



### 复制方式

- 星型：一主多从
- 树形：主-从-从
- 半同步复制
  - min-slaves-to-write 3
  - min-slaves-max-lag 10
  - 那么在从服务器的数量少于3个，或者三个从服务器的延迟（lag）值都大于或等于10秒时，主服务器将拒绝执行写命令，这里的延迟值就是上面提到的INFO replication命令的lag值。

